<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=generator content="Hugo 0.68.1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Wenjy's Blog | 回首往事，不会因为虚度年华而悔恨，也不会因为碌碌无为而感到羞愧。</title><meta property="og:title" content="Wenjy's Blog | 回首往事，不会因为虚度年华而悔恨，也不会因为碌碌无为而感到羞愧。"><meta property="og:type" content="website"><meta name=Keywords content="PHP,Swoole,Web开发"><meta name=description content="记录工作、学习中遇到的问题和解决方法..."><meta property="og:url" content="https://blog.wenjy.top/"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/style.css><link rel=alternate type=application/rss+xml+xml href=https://blog.wenjy.top/index.xml title="Wenjy's Blog"><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><h1><a id=logo href=https://blog.wenjy.top>Wenjy's Blog</a></h1><p class=description>回首往事，不会因为虚度年华而悔恨，也不会因为碌碌无为而感到羞愧。</p></div><div><nav id=nav-menu class=clearfix><a class=current href=https://blog.wenjy.top>首页</a>
<a href=https://blog.wenjy.top/archives title=归档>归档</a>
<a href=https://blog.wenjy.top/about title=关于>关于</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title><a href=https://blog.wenjy.top/work/ title=Work>Work</a></h1></header><date class="post-meta meta-date">2019年10月11日</date><div class=post-content>工作中遇到的问题+踩过的坑 2019.4.10 安装的虚拟机时间不同步 ntpdate cn.pool.ntp.org 2019.4.11 phpxdebug 运行失败，端口繁忙 因为 phpxdebug 端口和 php 默认监听的端口冲突，都是默认9000
把 phpxdebug port 设置为 9001
本地测试环境curl，https时因为没有设置公钥而失败 设置 2019.4.15 yar Yar_Client 报错：curl exec failed &lsquo;Timeout was reached&rsquo; 2019.4.16 phpstudy 的PHP默认是32位的，long2ip() 时会有问题，需要换装64位的 reids 也是32位，溢出问题 直接替换 phpstudy 的 php 为 64位版本的，但是 redis 在win上没有，最后使用虚拟机了
2019.4.17 升级框架，laravel/lumen 5.6.* -> 5.8.* 按照5.8.*修改composer.json依赖一致，然后利用gitbug的文件对比功能，修改改变的文件。 使用 github 版本文件对比，修改更改的文件和受影响的改动
Comparing changes
2019.4.18 reids重启后rdb文件没有加载，原因 dir 设置的是 .……</div><p class=readmore><a href=https://blog.wenjy.top/work/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://blog.wenjy.top/mysql/ title=Mysql>Mysql</a></h1></header><date class="post-meta meta-date">2019年10月11日</date><div class=post-content>一、索引 索引的类型（数据结构） 1. B-Tree 所有引擎都支持
InnoDB(根据主键引用被索引的行，索引和数据同一个文件)、MyISAM(通过数据的物理位置应用被索引的行，索引和数据是不同的文件)
多列索引 需要满足最左原则，where条件必须和索引的顺序一致，如果只用到单列则必须是最左列
InnoDB使用聚簇索引（一种数据存储方式） 聚簇索引的表现形式为，二级索引里包含了主键列（二级索引的行指针是指向行的主键值而不是行的物理地址），所以使用InnoDB时应该尽可能建一个递增的（顺序主键）如果没有则会隐式定义一个主键来作为聚簇索引
覆盖索引 如果一个索引包含所有需要查询的字段的值
使用索引扫描来做排序 只有当索引的列顺序和ORDER BY子句的顺序完全一致，并且所有列的排序方向（倒序或正序）都一样时，MySQL才能够使用索引来对结果做排序。如果查询需要关联多张表，则只有当ORDER BY子句引用的字段全部为第一个表时，才能使用索引做排序。也需要满足索引的最左前缀要求（例外：前导列为常量的时候）。
建如下表测试索引排序
CREATE TABLE `test` ( `id` int(11) NOT NULL AUTO_INCREMENT, `realname` varchar(10) NOT NULL DEFAULT '', `sex` tinyint(4) NOT NULL DEFAULT '0', `age` tinyint(4) NOT NULL DEFAULT '0', `job` varchar(10) NOT NULL DEFAULT '', PRIMARY KEY (`id`), KEY `test_realname_sex_age_index` (`realname`,`sex`,`age`), KEY `sex_index` (`sex`), KEY `age_index` (`age`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8……</div><p class=readmore><a href=https://blog.wenjy.top/mysql/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://blog.wenjy.top/linux/lock/ title=Lock>Lock</a></h1></header><date class="post-meta meta-date">2019年10月11日</date><div class=post-content>《操作系统之哲学原理》-锁 死锁的4个必要条件 死锁发生的必要条件是 资源有限
持有等待
不能抢占资源
循环等待条件
哲学家就餐问题 哲学家每天只做两家事情：思考 吃饭 吃饭规矩：哲学家围在一张圆桌边，每个人的左右两边均放着一根筷子。如果要吃饭，需要获得左右 的筷子（不能用一根筷子吃饭）
运行的算法：
等待左边的筷子可用，然后拿起左边的筷子 等待右边的筷子可用，然后拿起右边的筷子 吃饭 放下两根筷子 如果每个哲学家穿插执行，将出现每个哲学家都拿起左边筷子，而等待右边筷子的情况，死锁将发生。
死锁的应对 两种策略：
一、允许死锁发生
假装没看见，不予理睬 死锁发生的概率比较低，防止死锁的代价很高，还不如重启
2.在死锁发生后，想办法予以解决(基本行不通，检测死锁不能肯定死锁发生、可能检测死锁的线程自己发生了死锁)
首先需要检测死锁，利用资源分配矩阵、资源等待矩阵、系统总资源、当前系统可用资源
死锁恢复，可用使用抢占、终止占用最多资源的线程、杀掉整个线程、rollback
动态避免 在每次进行资源分配时，必须经过仔细的计算，确保该资源请求批准后系统不会进入死锁或者潜在死锁状态
系统当前可用资源：3
线程 已持有 总需求 A 3 9 B 2 4 C 2 7 这个状态是否是安全状态？答案是 是安全状态……</div><p class=readmore><a href=https://blog.wenjy.top/linux/lock/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://blog.wenjy.top/php/php7-array/ title="PHP7 Array">PHP7 Array</a></h1></header><date class="post-meta meta-date">2019年10月11日</date><div class=post-content>PHP7数组的实现 PHP数组是一个有序的字典，它必须同时满足下面两个语义 PHP数组是一个字典，存储着键-值（key-value）对，通过键可以快速地找到对应的值，键可以是整形、字符串。
PHP数组是有序的，这个有序是指插入顺序，即遍历数组的时候，遍历元素的顺序应该和插入的顺序一致。
为了实现语义1，PHP使用 HashTable 来存储 key-value ，但是 HashTable 只能保证语义1
php使用了带h值的 HashTable key/value -> hash1函数 -> h值 -> hash2函数 -> slotN -> bucket()
示意图：
bucket里面增加了 h 字段
hash函数拆分成 hash1 和 hash2 函数，hash1 将 key 映射成 h值，hash2 将 h 值映射为 slot 的索引值
bucket 里的 key 作为字符串key
HashTable 的key可能为数字，也可能是字符串，如果是数字那么 h值就代表数字key，如果是字符串，计算出h值，key1和key2比较时 先比较它们的h值是否相等，如果相等在比较key1和key2是否相等，因为大部分场景，不同字符串的h值都不会相等，这样提高了 HashTable 的插入、查找速度。……</div><p class=readmore><a href=https://blog.wenjy.top/php/php7-array/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://blog.wenjy.top/archives/ title=Archives>Archives</a></h1></header><date class="post-meta meta-date">2019年10月10日</date><div class=post-content>……</div><p class=readmore><a href=https://blog.wenjy.top/archives/>阅读全文</a></p></article><article class=post><header><h1 class=post-title><a href=https://blog.wenjy.top/about/ title=About>About</a></h1></header><date class="post-meta meta-date">2019年10月10日</date><div class=post-content>……</div><p class=readmore><a href=https://blog.wenjy.top/about/>阅读全文</a></p></article></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://blog.wenjy.top>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>分类</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>标签</h3><div class=tagcloud></div></section><section class=widget><h3 class=widget-title>友情链接</h3><ul class=widget-list><li><a target=_blank href=https://mikelin.cn title="MIKELIN | 关注科技，弘扬互联网精神！">MIKELIN</a></li><li><a target=_blank href=https://blog.wenjy.top title=江湖义气的网络日志>江湖义气的网络日志</a></li></ul></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://blog.wenjy.top/index.xml>文章 RSS</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href=https://blog.wenjy.top>Wenjy's Blog By 江湖义气</a>.
Powered by <a rel="nofollow noreferer noopener" href=https://gohugo.io target=_blank>Hugo</a>.
<a href=https://www.flysnow.org/ target=_blank>Theme</a> based on <a href=https://github.com/rujews/maupassant-hugo target=_blank>maupassant</a>.</div></footer><a id=rocket href=#top></a><script type=text/javascript src="/js/totop.js?v=0.0.0" async></script><script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script></body></html>