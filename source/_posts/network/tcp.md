---
title: "TCP协议"
keywords: "TCP协议"
description: "TCP协议"
date: 2020-12-27T20:53:12+08:00
tags: ["TCP", "Network"]
categories: ["TCP"]
reprintPolicy: noreprint
---

## TCP协议

> TCP是面向连接的传输层协议，需建立连接，数据传输完毕后必须释放已建立的连接

> 每条TCP连接只能有两个端点，点对点。连接的端点叫做**套接字**（socket），由IP+端口和冒号组成。

>TCP提供可靠交付的服务，无差错、不丢失、不重复、并且按序到达。

> 提供**全双工通信**，TCP连接的两端都设有发送和接收缓存，应用程序只需要把数据传送给TCP，具体数据发送由TCP来决定，接收时，TCP把收到
的数据放入缓存，上层应用在合适的时候读取缓存中的数据。

> 面向字节流（stream），流入进程或从进程流出的字节序列。TCP把应用程序交下拉的数据看成仅仅是一串**无结构的字节流**，并不要知道其中的含义，
>不保证接收应用收到的数据块和发送方应用程序所发出的数据块具有对应大小的关系。

### 停止等待协议

> 每发送完一个分组就停止发送，等待对方的确认，在收到确认后再发送下一个分组。

#### 自动重传请求ARQ（Automatic Repeat Request）

- 无差错

A发送分组M1，发送完就暂停，等待B的确认，B收到M1就向A发送确认。

- 出差错

B接收M1是检测出了差错，就丢弃M1，其他什么都不做。因为A只要超过一段时间没有收到B的确认，就认为刚发送的分组丢失，
因而重传前面发送过的分组，这叫**超时重传**。要实现超时重传，需要在每发送一个分组就设置一个**超时计时器**。如果在
超时计时器到期之前收到了对方的确认，就撤销已经设置的超时计时器。

1、A在发送完一个分组后，须暂时保留以发送的分组副本（重传可能需要使用），收到确认后才能清除副本。

2、分组和确认分组都必须进行编号，这样才能明确是哪一个分组收到了确认。

3、超时计时器设置的重传时间应当比数据在分组传输的平均往返时间更长一些，如果设置的很长，那么通信效率就会很低，如果设置很短，就会产生很多不必要的重传，浪费网络资源

- 确认丢失和确认迟到

A在设定的超时重传时间内没有收到确认，但这时并无法确定是自己发送的分组出错、丢失，还是B发送的确认丢失。因此A要重传此分组。

1、确认丢失，假设B又收到了重传的分组M1，则B应丢弃这个分组，并向A发送确认M1，不能认为已经发送过确认就不再发送，
因为A之所以重传M1，就是表示A没有收到M1的确认。

2、确认迟到，A会收到重复的确认，A只需要丢弃这个重复的确认

### 流水线传输

> 发送方可以连续发送多个分组，不必没发完一个就停下来等待对方的确认，这样可以提供信道利用率。

### 连续ARQ协议

> 发送方每收到一个确认，就把发送窗口向前滑动一个分组的位置，接收方可以采用积累确认的方式，对按序到达的最后一个分组进行确认，
>这就表示，到这个分组为止的所有分组都已正确收到。

积累确认的优点是容易实现，缺点是不能向发送方反映出接收方已正确收到的所有分组信息。例如，如果发送方发送了5个分组，
中间的第3个分组丢失，这时接收方只能多前2个分组发出确认，发送方无法置顶第3个分组的下落，只好把3-5分组都进行重传。
所以在通信线路质量不好时，连续ARQ协议会带来负面影响

### 滑动窗口协议

> 位于发送窗口的分组都可以连续发送出去，不需要等待对方的确认。

