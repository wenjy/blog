<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=generator content="Hugo 0.58.3"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Mysql | Wenjy&#39;s Blog</title><meta property=og:title content="Mysql - Wenjy's Blog"><meta property=og:type content=article><meta property=article:published_time content=2019-10-11T22:30:57&#43;08:00><meta property=article:modified_time content=2019-10-11T22:30:57&#43;08:00><meta name=Keywords content=PHP,Swoole,Web开发><meta name=description content=Mysql><meta name=author content=江湖义气><meta property=og:url content=https://blog.wenjy.top/mysql/><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/normalize.css><link rel=stylesheet href=/css/prism.css><link rel=stylesheet href=/css/style.css><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script></head><body><header id=header class=clearfix><div class=container><div class=col-group><div class=site-name><a id=logo href=https://blog.wenjy.top>Wenjy&#39;s Blog</a><p class=description>回首往事，不会因为虚度年华而悔恨，也不会因为碌碌无为而感到羞愧。</p></div><div><nav id=nav-menu class=clearfix><a href=https://blog.wenjy.top>首页</a>
<a href=https://blog.wenjy.top/archives title=归档>归档</a>
<a href=https://blog.wenjy.top/about title=关于>关于</a></nav></div></div></div></header><div id=body><div class=container><div class=col-group><div class=col-8 id=main><div class=res-cons><article class=post><header><h1 class=post-title>Mysql</h1></header><date class="post-meta meta-date">2019年10月11日</date><div class=post-meta><span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span> 阅读</span></span></div><div class=post-content><h2 id=一-索引>一、索引</h2><h3 id=索引的类型-数据结构>索引的类型（数据结构）</h3><h4 id=1-b-tree>1. B-Tree</h4><blockquote><p>所有引擎都支持</p><p>InnoDB(根据主键引用被索引的行，索引和数据同一个文件)、MyISAM(通过数据的物理位置应用被索引的行，索引和数据是不同的文件)
- 多列索引
需要满足最左原则，where条件必须和索引的顺序一致，如果只用到单列则必须是最左列</p></blockquote><ul><li><p>InnoDB使用聚簇索引（一种数据存储方式）
&gt; 聚簇索引的表现形式为，二级索引里包含了主键列（二级索引的行指针是指向行的主键值而不是行的物理地址），所以使用InnoDB时应该尽可能建一个递增的（顺序主键）如果没有则会隐式定义一个主键来作为聚簇索引</p></li><li><p>覆盖索引
&gt; 如果一个索引包含所有需要查询的字段的值</p></li><li><p>使用索引扫描来做排序</p></li></ul><blockquote><p>只有当索引的列顺序和ORDER BY子句的顺序完全一致，并且所有列的排序方向（倒序或正序）都一样时，MySQL才能够使用索引来对结果做排序。如果查询需要关联多张表，则只有当ORDER BY子句引用的字段全部为第一个表时，才能使用索引做排序。也需要满足索引的最左前缀要求（例外：前导列为常量的时候）。</p><p>建如下表测试索引排序</p></blockquote><p><code>CREATE TABLE `test` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`realname` varchar(10) NOT NULL DEFAULT '',
`sex` tinyint(4) NOT NULL DEFAULT '0',
`age` tinyint(4) NOT NULL DEFAULT '0',
`job` varchar(10) NOT NULL DEFAULT '',
PRIMARY KEY (`id`),
KEY `test_realname_sex_age_index` (`realname`,`sex`,`age`),
KEY `sex_index` (`sex`),
KEY `age_index` (`age`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8</code>
1. 使用两种不同的排序方向排序</p><ul><li>能使用索引排序</li></ul><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY sex DESC ,age DESC;</p></blockquote><ul><li>不能使用索引排序</li></ul><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY sex DESC ,age ASC ;</p></blockquote><ol><li>用了一个不在索引中的列</li><li>不能</li></ol><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY sex,job;</p></blockquote><ol><li>where order by中的列无法组合成索引的最左前缀</li></ol><ul><li>不能</li></ul><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY age;</p></blockquote><ul><li>能</li></ul><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY sex;</p></blockquote><ol><li>查询在索引第一列上是范围条件</li></ol><ul><li>不能</li></ul><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname &gt; &lsquo;wen&rsquo; ORDER BY sex,age;</p><p>EXPLAIN SELECT * FROM test WHERE realname BETWEEN &lsquo;wen1&rsquo; AND &lsquo;wen2&rsquo; ORDER BY sex,age;</p></blockquote><ol><li>索引上有多个等于条件</li></ol><ul><li>不能</li></ul><blockquote><p>EXPLAIN SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; AND sex IN (1,2) ORDER BY age;</p></blockquote><ol><li>前导列不为常量，并且使用范围条件</li></ol><blockquote><p>不能 EXPLAIN SELECT * FROM test WHERE realname &gt; &lsquo;qqq&rsquo; ORDER BY realname;</p><p>能 EXPLAIN SELECT * FROM test WHERE realname = &lsquo;qqq&rsquo; ORDER BY realname;</p></blockquote><ul><li>选择合适的索引顺序</li></ul><blockquote><p>一般来说：将选择性最高的列放到索引的最前列。计算方法
SELECT count(DISTINCT realname)/COUNT(*) realname_selectivity,count(DISTINCT sex)/COUNT(*) sex_selectivity,count(DISTINCT age)/COUNT(*) age_selectivity,count(*) total FROM test;</p></blockquote><ul><li>单索引排序</li></ul><ol><li>where条件和排序的列不一致</li></ol><blockquote><p>不能使用索引排序 EXPLAIN SELECT * FROM test WHERE sex = 1 ORDER BY age;</p><p>能 EXPLAIN SELECT * FROM test WHERE sex = 1 ORDER BY sex;</p><p>能 EXPLAIN SELECT * FROM test WHERE age &gt; 17 ORDER BY age;</p></blockquote><ol><li>没有where条件直接排序</li></ol><blockquote><p>主键可以排序 EXPLAIN SELECT * FROM test ORDER BY id;</p><p>不能 EXPLAIN SELECT * FROM test ORDER BY sex;</p></blockquote><ol><li>多where条件</li></ol><blockquote><p>不能，不满足左前缀 EXPLAIN SELECT * FROM test WHERE sex = 1 AND age &gt; 17 ORDER BY age;</p><p>不能，不满足左前缀 EXPLAIN SELECT * FROM test WHERE sex &gt; 1 AND age &gt; 17 ORDER BY age;</p><p>不能，没有建多列索引 EXPLAIN SELECT * FROM test WHERE sex &gt; 1 AND age &gt; 18 ORDER BY sex,age;</p><p>能 EXPLAIN SELECT * FROM test WHERE age &gt; 17 ORDER BY age;</p><p>能 EXPLAIN SELECT * FROM test WHERE sex &gt; 1 AND age &gt; 17 ORDER BY sex;</p></blockquote><ul><li>优化排序分页</li></ul><blockquote><p>排序分页达到一定数量时（使用ORDER BY LIMIT），越往后面翻页越卡，可以通过使用覆盖索引查询返回需要的主键，再根据主键关联原表获得所需要的行</p><p>SELECT * FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY sex LIMIT 100000,10;</p><p>SELECT * FROM test INNER JOIN (SELECT id FROM test WHERE realname = &lsquo;wen&rsquo; ORDER BY sex LIMIT 100000,10) t USING (id);</p></blockquote><h4 id=2-哈希索引>2. 哈希索引</h4><blockquote><p>Memory引擎显式支持</p></blockquote><h4 id=3-空间数据索引-r-tree>3. 空间数据索引（R-Tree）</h4><h4 id=4-全文索引-full-text>4. 全文索引(Full-text)</h4><blockquote><p>同列可创建全文索引和B-Tree索引</p></blockquote><h2 id=二-查询优化>二、查询优化</h2></div><div class=post-archive><h2>See Also</h2><ul class=listing><li><a href=/linux/lock/>Lock</a></li><li><a href=/php/php7-array/>PHP7 Array</a></li><li><a href=/archives/>Archives</a></li><li><a href=/about/>About</a></li></ul></div><div class="post-meta meta-tags">没有标签</div></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=wenjy/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div><div id=secondary><section class=widget><form id=search action=//www.google.com/search method=get accept-charset=utf-8 target=_blank _lpchecked=1><input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://blog.wenjy.top>
<button type=submit class="submit icon-search"></button></form></section><section class=widget><h3 class=widget-title>最近文章</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>分类</h3><ul class=widget-list></ul></section><section class=widget><h3 class=widget-title>标签</h3><div class=tagcloud></div></section><section class=widget><h3 class=widget-title>友情链接</h3><ul class=widget-list><li><a target=_blank href=https://mikelin.cn title="MIKELIN | 关注科技，弘扬互联网精神！">MIKELIN</a></li><li><a target=_blank href=https://wenjy.top title=江湖义气的网络日志>江湖义气的网络日志</a></li></ul></section><section class=widget><h3 class=widget-title>其它</h3><ul class=widget-list><li><a href=https://blog.wenjy.top/index.xml>文章 RSS</a></li></ul></section></div></div></div></div><footer id=footer><div class=container>&copy; 2020 <a href=https://blog.wenjy.top>Wenjy&#39;s Blog By 江湖义气</a>.
Powered by <a rel="nofollow noreferer noopener" href=https://gohugo.io target=_blank>Hugo</a>.
<a href=https://www.flysnow.org/ target=_blank>Theme</a> based on <a href=https://github.com/rujews/maupassant-hugo target=_blank>maupassant</a>.</div></footer><script type=text/javascript>(function(){$("pre code").parent().addClass("line-numbers")}());window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:true}};</script><script type=text/javascript src=/js/prism.js async></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><a id=rocket href=#top></a><script type=text/javascript src="/js/totop.js?v=0.0.0" async></script><script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script></body></html>